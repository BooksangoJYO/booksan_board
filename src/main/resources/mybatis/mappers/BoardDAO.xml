<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC  "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.booksan.booksan_board.dao.BoardDAO">
	<sql id="search">
		<where>
			<if test="keyword != null and keyword != ''">
				<choose>
					<when test="searchType == 'board'">
						concat_ws(' ', title, content) like concat('%', #{keyword}, '%')
					</when>
					<when test="searchType == 'book'">
						concat_ws(' ' <!--도서 db 컬럼명 입력-->) like concat('%', #{keyword}, '%')
					</when>
					<!--통합 검색 쿼리 추가 필요-->
				</choose>
			</if>
		</where>
	</sql>


	<!-- 게시물 등록 -->
	<insert id="insertBoard">
		insert into DEALS_BOARD (title, content, books_category_id, isbn, price,nickname)
		values (#{title},#{content},#{booksCategoryId},#{isbn},#{price},#{nickname})
	</insert>
	
	<!-- 게시물 단건조회 -->
	<select id="readBoardById">
		select * from DEALS_BOARD where deal_id=#{dealId} and disabled='N'
	</select>

	<!-- 게시물 목록 -->
	<select id="getBoardList">
		select * from DEALS_BOARD 
		<include refid="search" />
		order by insert_datetime DESC 
		limit #{skip}, #{size}
	</select>
	
	<!-- 게시물 수정 -->
	<update id="updateBoard" parameterType="io.booksan.booksan_board.vo.BoardVO">
		update DEALS_BOARD
		set title=#{title},
			content=#{content},
			books_category_id=#{booksCategoryId},
			isbn=#{isbn},
			price=#{price},		
			updated_datetime=now(),
			status=#{status}
		where deal_id=#{dealId}			
	</update>
	
	<!-- 게시물 삭제(상태변경) -->
	<update id="deleteBoard">
		update DEALS_BOARD
		set disabled='Y'
		where deal_id=#{dealId}
	</update>
	
	<!-- 게시물 목록 개수(페이지네이션) -->
	<select id="getTotalCount">
		select count(*) 
		from DEALS_BOARD 
		<include refid="search" />
	</select>

</mapper>